#!/usr/bin/env bash

# Lists args and asks users to pick on (via stderr) and sets the variable named
# by $1 to the value picked
function picker()
{ # $1 - Storage name, $2-* choices
  if (( $# < 2 )); then
    return
  fi

  local key
  key=$1
  shift 1
  
  local args=("${@}")

  local x
  while true; do
    for x in "${!args[@]}"; do
      x=$((x+1))
      printf "%2s) ${!x}\n" $x >&2
    done
    echo >&2

    read -r -p "Please pick a number between 1 and $#: " x

    if (( ${x} > 0 )) && (( ${x} <= $# )); then
      export "${key}"="${!x}"
      export "${key}_index"="$((x-1))"
      break
    fi
  done  
}

# Return 0 shouldn't happen... but it means no choice
# Usage: my_choice=$(picker Choice1 Choice2 ...)
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  picker my_choice ${@+"${@}"}
  echo ${my_choice}
  exit $((${my_choice_index--1}+1))
fi