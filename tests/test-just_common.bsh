#!/usr/bin/env bash

. "$(dirname ${BASH_SOURCE[0]})/testlib.sh"

VSI_COMMON_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.."; pwd)"
. "${VSI_COMMON_DIR}/linux/just_common.bsh"

begin_test "JUST_VERSION check"
(
  set -eu
  SPOOF_VERSION="${JUST_VERSION}.1"

  message="$(set +xv; source "${VSI_COMMON_DIR}/linux/just_common.bsh" 2>&1 1>/dev/null)"
  [ "${message}" = "" ]

  message="$(set +xv; JUST_VERSION="${SPOOF_VERSION}" source "${VSI_COMMON_DIR}/linux/just_common.bsh" 2>&1 1>/dev/null)"
  [[ "${message}" = WARNING:* ]]
)
end_test

begin_test "just parse helps"
(
  JUST_HELP_SEPARATOR='#@#'
  set -eu
  s=$'what) #huh\n'
  s+=$'a|b|c) # test\n'
  s+=$'mix|mix_ed|mixed) # test\n'
  s+=$'mix_ed|mixed) # test\n'
  s+=$'mix|mix_ed) # test\n'
  s+='d|\\\ne) # foo\n'
  _just_parse_helps <(printf "${s}")
)
end_test