. "$(dirname ${BASH_SOURCE[0]})/testlib.sh"

TEST_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")"; pwd)"

begin_test "Begin, ends, and sets"
(
  set -eu
  begin_tests=$(grep -E '^ *begin_test |^ *begin_fail_test |^ *begin_must_fail_test ' "${TEST_DIR}"/test-* | wc -l)
  end_tests=$(grep '^ *end_test$' "${TEST_DIR}"/test-* | wc -l)
  set_e_s=$(grep '^ *set -[a-z]*e' "${TEST_DIR}"/test-* | wc -l)

  set_e_s=$((set_e_s - 1)) # In case there are extra set -e's uses, this gives
  # a place for the offset to make the test pass
  # 1 for teardown in testlib-touch

  [ $begin_tests -eq $end_tests ]
  [ $begin_tests -eq $set_e_s ]
)
end_test