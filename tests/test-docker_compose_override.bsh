
. "$(dirname ${BASH_SOURCE[0]})/testlib.sh"
. "$(dirname ${BASH_SOURCE[0]})/test_utils.bsh"

VSI_COMMON_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.."; pwd)"
. "${VSI_COMMON_DIR}/linux/docker_compose_override"

# simple1="\
# version: '3.2'
# services:
#   test:
#     image:
#       alpine"

head="\
version: '3.2'
services:"
a_test1="
  test1:"
a_volume1="
    volumes:
      - /test:/foo"

ans2_3="\
version: '2.3'
services:
  test1:
  test2:"

# setup()
# {
#   temp_dir="$(mktemp -d -u)"
# }

begin_test "No services"
(
  set -eu
  [ "$(generate_docker_compose_override PROJECT)" = "${head}" ]
)
end_test

begin_test "CLI"
(
  set -eu
  ans="${head}${a_test1}"
  [ "$("${VSI_COMMON_DIR}/linux/docker_compose_override" PROJECT test1)" = "${ans}" ]
)
end_test

begin_test "Version 2.3"
(
  set -eu
  COMPOSE_VERSION=2.3
  [ "$(generate_docker_compose_override PROJECT test1 test2)" = "${ans2_3}" ]
)
end_test


# teardown()
# (
#   rmdir "${temp_dir}"
# )
