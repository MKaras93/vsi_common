#!/usr/bin/env bash

. "$(dirname ${BASH_SOURCE[0]})/../testlib.sh"

VSI_COMMON_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.."; pwd)"

begin_test "Justfile test"
(
  setup_test
  JUSTFILE="${VSI_COMMON_DIR}/linux/Justfile_pipfile" "${VSI_COMMON_DIR}/linux/just" help | \
    grep init_pipfile3
)
end_test

! command -v ${DOCKER} &>/dev/null && skip_next_test
begin_test "init_pipfile3"
(
  setup_test

  "${VSI_COMMON_DIR}/linux/Justfile_pipfile" init_pipfile3 python:3 "${TESTDIR}"

  [ -s "${TESTDIR}/Pipfile" ]
  [ -s "${TESTDIR}/Pipfile.lock" ]
)
end_test

! command -v ${DOCKER} &>/dev/null && skip_next_test
begin_test "debian_no_python_init_pipfile3"
(
  setup_test

  "${VSI_COMMON_DIR}/linux/Justfile_pipfile" debian_no_python_init_pipfile3 debian:8 "${TESTDIR}"

  [ -s "${TESTDIR}/Pipfile" ]
  [ -s "${TESTDIR}/Pipfile.lock" ]
)
end_test

! command -v ${DOCKER} &>/dev/null && skip_next_test
begin_test "fedora_init_pipfile3"
(
  setup_test

  "${VSI_COMMON_DIR}/linux/Justfile_pipfile" fedora_init_pipfile3 fedora:27 "${TESTDIR}"

  [ -s "${TESTDIR}/Pipfile" ]
  [ -s "${TESTDIR}/Pipfile.lock" ]
)
end_test

! command -v ${DOCKER} &>/dev/null && skip_next_test
begin_test "centos_no_python_init_pipfile3"
(
  setup_test

  "${VSI_COMMON_DIR}/linux/Justfile_pipfile" centos_no_python_init_pipfile3 centos:7 "${TESTDIR}"

  [ -s "${TESTDIR}/Pipfile" ]
  [ -s "${TESTDIR}/Pipfile.lock" ]
)
end_test

! command -v ${DOCKER} &>/dev/null && skip_next_test
begin_test "init_pipfile2"
(
  setup_test

  "${VSI_COMMON_DIR}/linux/Justfile_pipfile" init_pipfile2 python:2 "${TESTDIR}"

  [ -s "${TESTDIR}/Pipfile" ]
  [ -s "${TESTDIR}/Pipfile.lock" ]
)
end_test

! command -v ${DOCKER} &>/dev/null && skip_next_test
begin_test "debian_no_python_init_pipfile2"
(
  setup_test

  "${VSI_COMMON_DIR}/linux/Justfile_pipfile" debian_no_python_init_pipfile2 debian:8 "${TESTDIR}"

  [ -s "${TESTDIR}/Pipfile" ]
  [ -s "${TESTDIR}/Pipfile.lock" ]
)
end_test

! command -v ${DOCKER} &>/dev/null && skip_next_test
begin_test "fedora_init_pipfile2"
(
  setup_test

  "${VSI_COMMON_DIR}/linux/Justfile_pipfile" fedora_no_python_init_pipfile2 fedora:27 "${TESTDIR}"

  [ -s "${TESTDIR}/Pipfile" ]
  [ -s "${TESTDIR}/Pipfile.lock" ]
)
end_test

! command -v ${DOCKER} &>/dev/null && skip_next_test
begin_test "centos_no_python_init_pipfile2"
(
  setup_test

  "${VSI_COMMON_DIR}/linux/Justfile_pipfile" centos_init_pipfile2 centos:7 "${TESTDIR}"

  [ -s "${TESTDIR}/Pipfile" ]
  [ -s "${TESTDIR}/Pipfile.lock" ]
)
end_test
