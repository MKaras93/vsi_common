#!/usr/bin/env bash

. "$(dirname ${BASH_SOURCE[0]})/testlib.sh"

begin_test "Test Success"
(
  set -eu

  echo "Working test ${@+${@}}"
)
end_test

begin_expected_fail_test "Test Expected Fail"
(
  set -eu

  echo "Failing test ${@+${@}}"

  false
)
end_test

begin_required_fail_test "Test Required Fail"
(
  set -eu

  echo "Required fail test ${@+${@}}"

  false
)
end_test

skip_next_test
begin_test "Test Skipped Test"
(
  set -eu

  check_skip

  false
)
end_test

begin_test "Test not"
(
  set -eu

  not false

  if not true; then
    false
  else
    true
  fi

  not not true
)
end_test

begin_test "Test not_s"
(
  set -eu

  not_s "[[ 1 == 2 ]]"
  not not_s "[[ 1 == 1 ]]"

  not_s "(( 1+5 < 6 )) "

  x=test
  y='t.st'
  not not_s '[[ $x =~ $y ]]'
  x=toast
  not_s '[[ $x =~ $y ]]'

  not_s "not_s true"
  not not_s "not_s false"
)
end_test

#****d* testlib.sh/TEST_CAUSE_FAIL
# NAME
#   TEST_CAUSE_FAIL - Run failing tests
# DESCRIPTION
#   In order to test testlib's failing cases, set TEST_CAUSE_FAIL=1 to cause
#   some actual failures. This isn't part of the normal tests because the only
#   real way to test a failure is to cause a real failure, which won't pass.
# AUTHOR
#   Andy Neff
#***
if [ "${TEST_CAUSE_FAIL}" == "1" ]; then
  begin_test "Test actual fail"
  (
    set -eu

    echo "Fail test ${@+${@}}"

    false
  )
  end_test

  begin_required_fail_test "Test failed required fail"
  (
    set -eu

    echo "Not failing when I should pass ${@+${@}}"
  )
  end_test
fi